# Replication2 - Petr


### Задание 1

1.1. В этом случае нужно просто каждый день в определенное время, например в 12:00 делать полный бэкап БД встроенными средствами, можно написать для этого скрипт и поместить в cron. И удалять старый бэкап или хранить эти бэкапы, к примеру за последные 10 дней с интревалом 1 день. Я бы советовал девать бэкап в виде набора sql запросов, чтобы не зависеть от версии БД.

1.2. Всё то же самое, только интревал раз в час.

1.3. В качестве решения можно запустить от 2-х БД, настроить между ними синхронную репликацию master-master. Настроить keepalived и при выходе из строя первой БД к примеру будет автоматически переключаться на работу со второй. Настроить мониторинг и алертменеджер и он сразу будет сообщать о выходе из строя ноды, чтобы своевременно их поднимать. Но бэкапирование я бы оставил всё равно, чтобы скрипт делал полный бэкап каждый час на отдельном сервере.


### Задание 2

2.1. Дамп и восстановление одной БД в текстовом виде (не зависит от версии pg_dump и pg_restore):
```bash
pg_dump -h localhost -U postgres -W -d exchange > exchange.sql
sudo -u postgres psql -U postgres -W -d exchange < exchange.sql
```

2.2. Нужно просто написать bash скрипт и поместить его в cron.

### Задание 3

3.1.

С помощью программы mysqlbackup проводится создание инкрементальной резервной копии сервера mysql, включая все базы данных

```bash
mysqlbackup --defaults-file=/home/dbadmin/my.cnf \
  --incremental --incremental-base=history:last_backup \
  --backup-dir=/home/dbadmin/temp_dir \
  --backup-image=incremental_image1.bi \
   backup-to-image
```

3.2. Использование реплики БД более предпочитительно в случае, если настроена синхронная репликация, в случае поломки master нужно будет просто переключиться на реплику в ручном или автоматическом режиме и продолжить работу как ни в чем не бывало
